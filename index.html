<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>PSET8</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <!-- D3 -->
    <script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Custom CSS -->
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,500" rel="stylesheet">


    <style type="text/css">
		.text_styling {
			font-family:"Open Sans";
			font-weight: 300;
			font-size: 12px;
		}
		.title_styling {
			font-family:"Open Sans";
			font-weight: 500;
			font-size: 18px;
		}
		.source_styling {
			font-family:"Open Sans";
			font-weight: 300;
			font-size: 10px;
		}

		h1 {
			font-family:"Open Sans";
			font-size:50px;
			font-weight:700;
			line-height:1.3;
		}
		h2 {
			font-family:"Open Sans";
			font-size:18px;
			font-weight:700;
		}
		p {
			font-family:"Open Sans";
			font-size:12px;
			font-weight:300;

		}

    #tooltip {
      position: absolute;
      width: 200px;
      height: 30px;
      padding: 5px;
      background: white;
      border: solid gray 1px;
      z-index: 1;
    }

    #tooltip.hidden{
      display:none;
    }

    line {
        stroke: red;
    }

    g.group0 path,
    g.group0 circle {
        stroke: red;
        fill: none;
    }

    /* add styles for axis ticks */
    g.tick line {
        stroke: black;
    }

    g.tick text {
        font-size: 8px;
        fill: black;
    }

    /* add hidden tick styles */
    g.hidden line,
    g.hidden path {
        display: none;
    }


		</style>
		</head>

<body>
  <main role="main" class="container" >
     <div class="row">
      <div class="col-12">
        <br><br>
        <h2>Boston 311 Requests</h2>

      </div>
      <div id="bar-chart"></div>
      <div id="tooltip" class="hidden">
        <p>
            <span id="value">100</span>
        </p>
     </div>
   </main>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
   <script type="text/javascript">
       const width = 800;
       const height = 600;
       const marginLeft = 300;
       const marginTop = 30;
       const marginBottom = 30;
       const marginRight = 30

       const barWidth = 50;
       const gap = 3;
       const barHeight = 15
       const barHeightMultiplier = 0.006;

       const svg = d3.select("#bar-chart")
           .append("svg")
           .attr("viewBox", [0, 0, width, height + marginBottom]);
           //.attr("width", width)
           //.attr("height", height);



           function plotBarChart(dataset) {
               // rectangle bars
               svg.append("g")
                   .attr("class", "bars")
                   .selectAll("rect")
                   .data(dataset)
                   .enter()
                   .append("rect")
                       .attr("x", d => marginLeft)
                       .attr("y", (d,i) => i * (barHeight + gap) + marginTop )
                       .attr("width", d => d.total_count * barHeightMultiplier)
                       .attr("height", (d, i) => barHeight)
                       .attr("fill", "teal")

                       .on("mouseover", function(event, d) {
                         d3.select("#tooltip")
                           .style("left", event.pageX + "px")
                           .style("top", event.pageY + "px")
                           .select("#value")
                           .data(dataset)
                           .html("<p>" + "Total 311 Requests: " + String(d.total_count) + "</p>")

                       d3.select("#tooltip")
                       .classed("hidden", false);
                       })

                       .on("mouseout", function() {
                       d3.select("#tooltip")
                       .classed("hidden", true);
                       });


                // define labels
 								svg.append("g")
 								.attr("class", "text_styling")
				            .selectAll("text")
 										.data(dataset)
 										.enter()
 												.append("text")
 												.attr("y", (d, i) => i * (barHeight + gap ) + marginTop + (barHeight/2) + 5)
 												.attr("x", marginLeft-5)
 												.attr("text-anchor", "end")
 												.text(d => d.Name)


                        const newArray = dataset.map(d => d.columnName);
                        const xValues = dataset.map(d => d.total_count);

                        const xScale = d3.scaleLinear()
                             // .domain([0, 180])
                             .domain([0, d3.max(xValues)])
                             .range([0, d3.max(xValues)*barHeightMultiplier]);

                        svg.append("g")
                               .attr("transform", "translate(300,30)")      // This controls the vertical position of the Axis
                               .call(d3.axisTop(xScale)
                               .ticks(6))
                               ;








           };


           </script>
          <!-- Bootstrap JS -->
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

           <!-- Custom JS -->
           <script type="text/javascript">
               d3.csv("boston_311.csv",d3.autoType)
                 .then(function(data) {
                 console.log(data);
                 data.sort(function(a, b){return b.total_count - a.total_count});
                 plotBarChart(data);
                 })
           </script>
        </script>
</body>
</html>
